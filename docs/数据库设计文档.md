# 水产养殖管理系统 - 数据库设计文档

## 数据库概述

- 数据库名称：`aquaculture_db`
- 字符集：`utf8mb4`
- 排序规则：`utf8mb4_unicode_ci`
- 存储引擎：`InnoDB`

---

## 数据表清单

### 1. 用户与权限管理模块

#### 1.1 用户信息表（sys_user）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| user_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 用户ID |
| username | VARCHAR | 50 | 否 | 是 | - | 账号（唯一） |
| password | VARCHAR | 255 | 否 | 是 | - | 加密密码 |
| real_name | VARCHAR | 50 | 否 | 否 | - | 真实姓名 |
| role_id | BIGINT | - | 否 | 是 | - | 角色ID（外键） |
| farm_id | BIGINT | - | 否 | 否 | - | 所属养殖场ID |
| phone | VARCHAR | 20 | 否 | 否 | - | 联系方式 |
| address | VARCHAR | 200 | 否 | 否 | - | 家庭地址 |
| avatar | VARCHAR | 255 | 否 | 否 | - | 头像路径 |
| status | TINYINT | - | 否 | 是 | 1 | 状态（0-禁用，1-启用） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`user_id`)
- UNIQUE KEY `uk_username` (`username`)
- KEY `idx_role_id` (`role_id`)

#### 1.2 角色表（sys_role）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| role_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 角色ID |
| role_name | VARCHAR | 50 | 否 | 是 | - | 角色名称 |
| role_desc | VARCHAR | 200 | 否 | 否 | - | 权限描述 |
| status | TINYINT | - | 否 | 是 | 1 | 状态（0-禁用，1-启用） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`role_id`)
- UNIQUE KEY `uk_role_name` (`role_name`)

#### 1.3 权限表（sys_permission）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| permission_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 权限ID |
| permission_code | VARCHAR | 100 | 否 | 是 | - | 权限标识（唯一） |
| permission_name | VARCHAR | 50 | 否 | 是 | - | 权限名称 |
| module | VARCHAR | 50 | 否 | 是 | - | 所属模块 |
| parent_id | BIGINT | - | 否 | 否 | 0 | 父权限ID |
| sort_order | INT | - | 否 | 是 | 0 | 排序顺序 |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`permission_id`)
- UNIQUE KEY `uk_permission_code` (`permission_code`)
- KEY `idx_module` (`module`)

#### 1.4 角色权限关联表（sys_role_permission）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 主键ID |
| role_id | BIGINT | - | 否 | 是 | - | 角色ID（外键） |
| permission_id | BIGINT | - | 否 | 是 | - | 权限ID（外键） |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_role_permission` (`role_id`, `permission_id`)

---

### 2. 基础数据管理模块

#### 2.1 养殖品种表（base_breed）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| breed_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 品种ID |
| breed_name | VARCHAR | 50 | 否 | 是 | - | 品种名称 |
| category | VARCHAR | 50 | 否 | 是 | - | 品类（鱼类/甲壳类等） |
| growth_cycle | INT | - | 否 | 否 | - | 生长周期（天） |
| unit | VARCHAR | 20 | 否 | 是 | '公斤' | 单位 |
| suitable_temp_min | DECIMAL | 5,2 | 否 | 否 | - | 适宜最低水温（℃） |
| suitable_temp_max | DECIMAL | 5,2 | 否 | 否 | - | 适宜最高水温（℃） |
| description | TEXT | - | 否 | 否 | - | 其他属性描述 |
| status | TINYINT | - | 否 | 是 | 1 | 状态（0-禁用，1-启用） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`breed_id`)
- KEY `idx_category` (`category`)

#### 2.2 养殖区域表（base_area）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| area_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 区域ID |
| area_code | VARCHAR | 50 | 否 | 是 | - | 区域编号（唯一） |
| area_name | VARCHAR | 100 | 否 | 是 | - | 区域名称 |
| area_size | DECIMAL | 10,2 | 否 | 是 | - | 面积（平方米） |
| department_id | BIGINT | - | 否 | 是 | - | 所属部门ID |
| location | VARCHAR | 200 | 否 | 否 | - | 位置信息 |
| water_quality | VARCHAR | 50 | 否 | 否 | - | 水质类型 |
| status | TINYINT | - | 否 | 是 | 1 | 状态（0-闲置，1-在用） |
| manager_id | BIGINT | - | 否 | 否 | - | 负责人ID（外键） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`area_id`)
- UNIQUE KEY `uk_area_code` (`area_code`)
- KEY `idx_department_id` (`department_id`)
- KEY `idx_manager_id` (`manager_id`)

#### 2.3 设备信息表（base_equipment）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| equipment_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 设备ID |
| equipment_name | VARCHAR | 100 | 否 | 是 | - | 设备名称 |
| equipment_model | VARCHAR | 100 | 否 | 否 | - | 设备型号 |
| equipment_type | VARCHAR | 50 | 否 | 是 | - | 设备类型（增氧机/投饵机等） |
| area_id | BIGINT | - | 否 | 是 | - | 区域ID（外键） |
| install_location | VARCHAR | 200 | 否 | 否 | - | 安装位置 |
| quantity | INT | - | 否 | 是 | 1 | 数量 |
| last_maintain_time | DATETIME | - | 否 | 否 | - | 最后维护时间 |
| maintain_record | TEXT | - | 否 | 否 | - | 维护记录 |
| status | TINYINT | - | 否 | 是 | 1 | 状态（0-故障，1-正常，2-维修中） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`equipment_id`)
- KEY `idx_area_id` (`area_id`)
- KEY `idx_equipment_type` (`equipment_type`)

---

### 3. 养殖计划管理模块

#### 3.1 养殖计划表（aquaculture_plan）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| plan_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 计划ID |
| plan_name | VARCHAR | 100 | 否 | 是 | - | 计划名称 |
| area_id | BIGINT | - | 否 | 是 | - | 区域ID（外键） |
| breed_id | BIGINT | - | 否 | 是 | - | 品种ID（外键） |
| target_yield | DECIMAL | 10,2 | 否 | 是 | - | 目标产量（公斤） |
| release_amount | DECIMAL | 10,2 | 否 | 是 | - | 投放量 |
| cycle_days | INT | - | 否 | 是 | - | 养殖周期（天） |
| start_date | DATE | - | 否 | 是 | - | 开始日期 |
| end_date | DATE | - | 否 | 否 | - | 预计结束日期 |
| feed_budget | DECIMAL | 10,2 | 否 | 否 | - | 饲料预算 |
| prevention_plan | TEXT | - | 否 | 否 | - | 防疫计划 |
| status | TINYINT | - | 否 | 是 | 0 | 状态（0-待审批，1-已通过，2-已驳回，3-执行中，4-已完成，5-已取消） |
| creator_id | BIGINT | - | 否 | 是 | - | 创建人ID（外键） |
| approver_id | BIGINT | - | 否 | 否 | - | 审批人ID（外键） |
| approve_opinion | TEXT | - | 否 | 否 | - | 审批意见 |
| approve_time | DATETIME | - | 否 | 否 | - | 审批时间 |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`plan_id`)
- KEY `idx_area_id` (`area_id`)
- KEY `idx_breed_id` (`breed_id`)
- KEY `idx_creator_id` (`creator_id`)
- KEY `idx_status` (`status`)

#### 3.2 计划调整表（plan_adjust）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| adjust_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 调整ID |
| plan_id | BIGINT | - | 否 | 是 | - | 原计划ID（外键） |
| adjust_reason | TEXT | - | 否 | 是 | - | 调整原因 |
| old_params | JSON | - | 否 | 否 | - | 原参数（JSON格式） |
| new_params | JSON | - | 否 | 否 | - | 新参数（JSON格式） |
| adjust_type | VARCHAR | 50 | 否 | 是 | - | 调整类型（延长周期/修改目标产量/其他） |
| approve_status | TINYINT | - | 否 | 是 | 0 | 审批状态（0-待审批，1-已通过，2-已驳回） |
| approver_id | BIGINT | - | 否 | 否 | - | 审批人ID（外键） |
| approve_opinion | TEXT | - | 否 | 否 | - | 审批意见 |
| approve_time | DATETIME | - | 否 | 否 | - | 审批时间 |
| creator_id | BIGINT | - | 否 | 是 | - | 创建人ID（外键） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`adjust_id`)
- KEY `idx_plan_id` (`plan_id`)
- KEY `idx_approve_status` (`approve_status`)

---

### 4. 产量统计管理模块

#### 4.1 产量统计表（yield_statistics）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| yield_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 产量ID |
| plan_id | BIGINT | - | 否 | 是 | - | 计划ID（外键） |
| area_id | BIGINT | - | 否 | 是 | - | 区域ID（外键） |
| breed_id | BIGINT | - | 否 | 是 | - | 品种ID（外键） |
| actual_yield | DECIMAL | 10,2 | 否 | 是 | - | 实际产量（公斤） |
| specification | VARCHAR | 50 | 否 | 否 | - | 规格 |
| statistics_date | DATE | - | 否 | 是 | - | 统计日期 |
| catch_time | DATETIME | - | 否 | 否 | - | 捕捞时间 |
| manager_id | BIGINT | - | 否 | 是 | - | 负责人ID（外键） |
| status | TINYINT | - | 否 | 是 | 0 | 状态（0-待审核，1-已通过，2-已驳回） |
| auditor_id | BIGINT | - | 否 | 否 | - | 审核人ID（外键） |
| audit_opinion | TEXT | - | 否 | 否 | - | 审核意见 |
| audit_time | DATETIME | - | 否 | 否 | - | 审核时间 |
| creator_id | BIGINT | - | 否 | 是 | - | 创建人ID（外键） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`yield_id`)
- KEY `idx_plan_id` (`plan_id`)
- KEY `idx_area_id` (`area_id`)
- KEY `idx_statistics_date` (`statistics_date`)
- KEY `idx_status` (`status`)

#### 4.2 产量凭证表（yield_evidence）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| evidence_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 凭证ID |
| yield_id | BIGINT | - | 否 | 是 | - | 产量ID（外键） |
| file_path | VARCHAR | 500 | 否 | 是 | - | 照片路径 |
| file_type | VARCHAR | 20 | 否 | 否 | - | 文件类型 |
| file_size | BIGINT | - | 否 | 否 | - | 文件大小（字节） |
| upload_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 上传时间 |
| uploader_id | BIGINT | - | 否 | 是 | - | 上传人ID（外键） |

**索引：**
- PRIMARY KEY (`evidence_id`)
- KEY `idx_yield_id` (`yield_id`)

---

### 5. 数据报表与分析模块

#### 5.1 统计结果表（statistic_result）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| statistic_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 统计ID |
| statistic_name | VARCHAR | 100 | 否 | 是 | - | 统计指标名称 |
| statistic_dimension | VARCHAR | 50 | 否 | 是 | - | 统计维度（部门/区域/品种/时间等） |
| dimension_value | VARCHAR | 100 | 否 | 否 | - | 维度值 |
| start_date | DATE | - | 否 | 否 | - | 开始日期 |
| end_date | DATE | - | 否 | 否 | - | 结束日期 |
| statistic_value | DECIMAL | 15,2 | 否 | 是 | - | 统计值 |
| statistic_unit | VARCHAR | 20 | 否 | 否 | - | 统计单位 |
| calculate_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 计算时间 |
| update_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`statistic_id`)
- KEY `idx_statistic_name` (`statistic_name`)
- KEY `idx_dimension` (`statistic_dimension`, `dimension_value`)

---

### 6. 操作日志与追溯模块

#### 6.1 操作日志表（sys_oper_log）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| log_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 日志ID |
| user_id | BIGINT | - | 否 | 是 | - | 用户ID（外键） |
| module | VARCHAR | 50 | 否 | 是 | - | 操作模块 |
| oper_type | VARCHAR | 50 | 否 | 是 | - | 操作类型（新增/修改/删除/审核/登录等） |
| oper_content | TEXT | - | 否 | 是 | - | 操作内容 |
| oper_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 操作时间 |
| ip_address | VARCHAR | 50 | 否 | 否 | - | IP地址 |
| oper_result | TINYINT | - | 否 | 是 | 1 | 操作结果（0-失败，1-成功） |
| error_msg | TEXT | - | 否 | 否 | - | 错误信息 |
| remark | VARCHAR | 500 | 否 | 否 | - | 备注信息 |

**索引：**
- PRIMARY KEY (`log_id`)
- KEY `idx_user_id` (`user_id`)
- KEY `idx_module` (`module`)
- KEY `idx_oper_time` (`oper_time`)

---

### 7. 消息通知模块

#### 7.1 消息表（sys_message）

| 字段名 | 类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|--------|------|------|----------|----------|--------|------|
| message_id | BIGINT | - | 是 | 是 | AUTO_INCREMENT | 消息ID |
| receiver_id | BIGINT | - | 否 | 是 | - | 接收人ID（外键） |
| sender_id | BIGINT | - | 否 | 否 | - | 发送人ID（外键，0表示系统） |
| message_title | VARCHAR | 200 | 否 | 是 | - | 消息标题 |
| message_content | TEXT | - | 否 | 是 | - | 消息内容 |
| message_type | VARCHAR | 20 | 否 | 是 | - | 消息类型（通知/提醒/公告） |
| business_type | VARCHAR | 50 | 否 | 否 | - | 关联业务类型 |
| business_id | BIGINT | - | 否 | 否 | - | 关联业务ID |
| status | TINYINT | - | 否 | 是 | 0 | 状态（0-未读，1-已读） |
| create_time | DATETIME | - | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 |
| read_time | DATETIME | - | 否 | 否 | - | 阅读时间 |

**索引：**
- PRIMARY KEY (`message_id`)
- KEY `idx_receiver_id` (`receiver_id`)
- KEY `idx_status` (`status`)
- KEY `idx_create_time` (`create_time`)

---

## 外键关系说明

1. `sys_user.role_id` → `sys_role.role_id`
2. `sys_user.manager_id` → `sys_user.user_id` (负责人)
3. `base_area.department_id` → 部门表（如需要）
4. `base_area.manager_id` → `sys_user.user_id`
5. `base_equipment.area_id` → `base_area.area_id`
6. `aquaculture_plan.area_id` → `base_area.area_id`
7. `aquaculture_plan.breed_id` → `base_breed.breed_id`
8. `aquaculture_plan.creator_id` → `sys_user.user_id`
9. `aquaculture_plan.approver_id` → `sys_user.user_id`
10. `plan_adjust.plan_id` → `aquaculture_plan.plan_id`
11. `plan_adjust.creator_id` → `sys_user.user_id`
12. `plan_adjust.approver_id` → `sys_user.user_id`
13. `yield_statistics.plan_id` → `aquaculture_plan.plan_id`
14. `yield_statistics.area_id` → `base_area.area_id`
15. `yield_statistics.breed_id` → `base_breed.breed_id`
16. `yield_statistics.manager_id` → `sys_user.user_id`
17. `yield_statistics.auditor_id` → `sys_user.user_id`
18. `yield_statistics.creator_id` → `sys_user.user_id`
19. `yield_evidence.yield_id` → `yield_statistics.yield_id`
20. `yield_evidence.uploader_id` → `sys_user.user_id`
21. `sys_oper_log.user_id` → `sys_user.user_id`
22. `sys_message.receiver_id` → `sys_user.user_id`
23. `sys_message.sender_id` → `sys_user.user_id`

---

## 数据库初始化建议

1. 初始化角色数据：
   - 系统管理员
   - 部门管理员
   - 普通操作员
   - 决策层

2. 初始化权限数据：
   - 根据功能模块创建对应权限
   - 为各角色分配相应权限

3. 创建默认管理员账号

---

*文档最后更新时间：2024年*

