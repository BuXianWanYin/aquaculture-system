# 水产养殖管理系统 - 功能模块整合文档

## 一、主要功能模块

### 1. 用户与权限管理模块

本模块为系统安全运行提供基础保障，实现用户身份认证与权限精细化控制。

#### （1）数据表设计

- **用户信息表（sys_user）**：存储用户ID、账号、加密密码、角色ID、状态等
- **角色表（sys_role）**：存储角色ID、角色名称（如"部门管理员"）、权限描述
- **权限表（sys_permission）**：存储权限ID、权限标识、所属模块
- **角色权限关联表（sys_role_permission）**：存储角色与权限的关联关系

#### （2）核心功能

**用户管理**
- 支持管理员、普通操作员、决策层角色的注册与登录
- 用户信息的新增、修改、删除、查询
- 用户状态管理（启用/禁用）

**权限控制**
- 区分管理员、普通操作员、决策层等不同角色
- 管理员拥有全系统操作权限
- 普通操作员仅能管理本部门或该区域数据
- 决策层仅具备数据查看权限
- 基于角色的权限分配与管理

**个人信息管理**
- 修改基本资料：所属养殖场、联系方式、家庭地址
- 密码修改、重置
- 个人头像上传

#### （3）实现文件

- Controller: `SysUserController.java`, `SysRoleController.java`, `SysPermissionController.java`
- Service: `SysUserService.java`, `SysRoleService.java`, `SysPermissionService.java`
- Domain: `SysUser.java`, `SysRole.java`, `SysPermission.java`, `SysRolePermission.java`

---

### 2. 基础数据管理模块

本模块维护系统核心基础数据，为养殖计划与产量统计提供数据支撑。

#### （1）数据表设计

- **养殖品种表（base_breed）**：存储品种ID、名称、品类、生长周期、单位等
- **养殖区域表（base_area）**：存储区域ID、名称、面积、所属部门、状态等
- **设备信息表（base_equipment）**：存储设备ID、名称、型号、区域ID、维护时间等

#### （2）核心功能

**养殖品种管理**
- 支持鱼类、甲壳类等品类划分
- 记录品种名称、生长周期、适宜水温等属性
- 品种信息的新增、修改、删除、查询

**养殖区域管理**
- 录入养殖场或池塘基本信息（编号、名称、面积、位置、水质类型）
- 标记使用状态（在用/闲置）
- 关联负责人
- 区域信息的新增、修改、删除、查询

**设备资源管理**
- 记录增氧机、投饵机等养殖设备的型号、数量
- 记录设备安装位置及维护记录
- 设备信息的新增、修改、删除、查询

#### （3）实现文件

- Controller: `BaseBreedController.java`, `BaseAreaController.java`, `BaseEquipmentController.java`
- Service: `BaseBreedService.java`, `BaseAreaService.java`, `BaseEquipmentService.java`
- Domain: `BaseBreed.java`, `BaseArea.java`, `BaseEquipment.java`

---

### 3. 养殖计划管理模块（核心模块）

本模块实现养殖计划全流程数字化管理，确保计划可执行、可追溯。

#### （1）数据表设计

- **养殖计划表（aquaculture_plan）**：存储计划ID、名称、区域ID、品种ID、目标产量、周期、状态等
- **计划调整表（plan_adjust）**：存储调整ID、原计划ID、调整原因、新参数、审批状态等

#### （2）核心功能

**计划录入**
- 普通操作员按区域或品种创建计划
- 填写投放量、目标产量、养殖周期、饲料预算、防疫计划等信息
- 计划信息的新增、修改、删除、查询

**计划审批**
- 部门管理员审核计划合理性（如投放量与区域面积匹配度等）
- 支持"通过或驳回"操作并填写意见
- 审批通过后计划生效

**计划调整**
- 允许因天气、病害等原因提交调整申请
- 支持延长周期、修改目标产量等调整
- 经二次审批后更新原计划

#### （3）实现文件

- Controller: `AquaculturePlanController.java`, `PlanAdjustController.java`
- Service: `AquaculturePlanService.java`, `PlanAdjustService.java`
- Domain: `AquaculturePlan.java`, `PlanAdjust.java`

---

### 4. 产量统计管理模块（核心模块）

本模块实现产量数据的精准采集、审核与关联分析，为收益核算提供依据。

#### （1）数据表设计

- **产量统计表（yield_statistics）**：存储产量ID、计划ID、区域ID、品种ID、实际产量、统计日期、状态等
- **产量凭证表（yield_evidence）**：存储照片路径、关联产量ID、上传时间等

#### （2）核心功能

**产量录入**
- 操作员按日、周、月记录实际捕捞量
- 关联对应养殖计划
- 记录品种、重量、规格、捕捞时间、负责人等信息
- 产量信息的新增、修改、删除、查询

**数据审核**
- 管理员核对产量数据
- 审核通过后计入统计库
- 驳回需注明原因

**计划完成率分析**
- 自动计算"累计实际产量 / 目标产量"
- 实时展示各计划、各区域的完成进度

#### （3）实现文件

- Controller: `YieldStatisticsController.java`, `YieldEvidenceController.java`
- Service: `YieldStatisticsService.java`, `YieldEvidenceService.java`
- Domain: `YieldStatistics.java`, `YieldEvidence.java`

---

### 5. 数据报表与分析模块

本模块通过多维度数据统计与可视化，为管理决策提供支持。

#### （1）数据表设计

- **统计结果表（statistic_result）**：存储预计算的统计指标（如月度产量、完成率）、统计维度、时间范围等

#### （2）核心功能

**部门级报表**
- 展示本部门计划总数、已完成数
- 月产量趋势分析
- 品种占比统计
- 支持按区域或时间筛选

**数据可视化**
- 首页仪表盘展示关键统计数据
- 多维度数据图表展示

#### （3）实现文件

- Controller: `StatisticResultController.java`, `DashboardController.java`
- Service: `StatisticResultService.java`
- Domain: `StatisticResult.java`

---

### 6. 操作日志与追溯模块

本模块记录关键操作轨迹，确保数据可追溯、责任可明确。

#### （1）数据表设计

- **操作日志表（sys_oper_log）**：存储日志ID、用户ID、操作模块、操作类型、内容、时间等

#### （2）核心功能

**日志记录**
- 自动记录用户登录、计划修改、产量审核等操作
- 包含操作人、时间、内容、IP地址
- **不记录查看操作（GET请求）**，仅记录新增、修改、删除等写操作

**日志查询**
- 支持按用户、模块、时间筛选日志
- 便于问题排查与责任追溯
- 日志分页查询与详情查看

#### （3）实现文件

- Controller: `SysOperLogController.java`
- Service: `SysOperLogService.java`
- Aspect: `OperLogAspect.java`（自动记录操作日志）
- Domain: `SysOperLog.java`

---

## 二、次要功能模块

### 1. 消息通知模块

及时推送关键信息，保障业务流程顺畅。

#### （1）数据表设计

- **消息表（sys_message）**：存储消息ID、接收人ID、内容、类型（通知/提醒）、状态等

#### （2）核心功能

**站内通知**
- 推送计划审批提醒
- 产量审核待办提醒
- 系统维护公告等

**消息管理**
- 支持标记已读或未读
- 删除消息
- 显示未读消息数量
- 消息分页查询

#### （3）实现文件

- Controller: `SysMessageController.java`
- Service: `SysMessageService.java`
- Domain: `SysMessage.java`

---

## 三、辅助功能模块

### 1. 文件上传模块

- 支持个人头像上传
- 支持产量凭证照片上传
- 文件存储与管理

#### 实现文件

- Controller: `FileUploadController.java`

---

## 四、模块关系图

```
用户与权限管理模块
    ↓
基础数据管理模块（品种、区域、设备）
    ↓
养殖计划管理模块 ← → 产量统计管理模块
    ↓                    ↓
数据报表与分析模块 ← → 操作日志与追溯模块
    ↑
消息通知模块
```

---

## 五、API接口汇总

### 用户与权限管理
- `/api/user/*` - 用户管理接口
- `/api/role/*` - 角色管理接口
- `/api/permission/*` - 权限管理接口

### 基础数据管理
- `/api/breed/*` - 养殖品种管理接口
- `/api/area/*` - 养殖区域管理接口
- `/api/equipment/*` - 设备管理接口

### 养殖计划管理
- `/api/plan/*` - 养殖计划管理接口
- `/api/planAdjust/*` - 计划调整管理接口

### 产量统计管理
- `/api/yield/*` - 产量统计管理接口
- `/api/yieldEvidence/*` - 产量凭证管理接口

### 数据报表与分析
- `/api/statistic/*` - 统计数据接口
- `/api/dashboard/*` - 仪表盘接口

### 操作日志
- `/api/operLog/*` - 操作日志查询接口

### 消息通知
- `/api/message/*` - 消息管理接口

### 文件上传
- `/api/upload/*` - 文件上传接口

---

## 六、权限控制说明

### 角色权限划分

1. **系统管理员（role_id=1）**
   - 拥有全系统操作权限
   - 可管理用户、角色、权限
   - 可查看所有数据

2. **部门管理员（role_id=2）**
   - 可管理本部门数据
   - 可审批计划、审核产量
   - 可查看本部门统计报表

3. **普通操作员（role_id=3）**
   - 仅能管理本部门或该区域数据
   - 可录入计划、产量数据
   - 可查看本区域数据

4. **决策层（role_id=4）**
   - 仅具备数据查看权限
   - 可查看统计报表和仪表盘
   - 无数据修改权限

### 权限注解

- `@RequiresRole({1})` - 仅系统管理员
- `@RequiresRole({1, 2})` - 系统管理员和部门管理员
- `@RequiresRole({1, 2, 3})` - 系统管理员、部门管理员和普通操作员

---

## 七、日志记录规则

### 记录的操作类型
- **POST** - 新增操作
- **PUT** - 修改操作
- **DELETE** - 删除操作
- **登录/登出** - 用户登录和登出操作

### 不记录的操作类型
- **GET** - 所有查看操作（查询、列表、详情等）
- **操作日志查询接口** - 避免日志记录日志
- **登录接口** - 避免重复记录

---

## 八、数据库表清单

### 用户与权限管理
- `sys_user` - 用户信息表
- `sys_role` - 角色表
- `sys_permission` - 权限表
- `sys_role_permission` - 角色权限关联表

### 基础数据管理
- `base_breed` - 养殖品种表
- `base_area` - 养殖区域表
- `base_equipment` - 设备信息表

### 养殖计划管理
- `aquaculture_plan` - 养殖计划表
- `plan_adjust` - 计划调整表

### 产量统计管理
- `yield_statistics` - 产量统计表
- `yield_evidence` - 产量凭证表

### 数据报表与分析
- `statistic_result` - 统计结果表

### 操作日志与追溯
- `sys_oper_log` - 操作日志表

### 消息通知
- `sys_message` - 消息表

---

## 九、技术栈

- **后端框架**: Spring Boot
- **ORM框架**: MyBatis Plus
- **数据库**: MySQL
- **缓存**: Redis
- **权限控制**: 基于角色的访问控制（RBAC）
- **日志记录**: AOP切面编程
- **文件上传**: Spring MVC文件上传

---

## 十、开发规范

1. **Controller层**: 负责接收请求、参数验证、调用Service、返回结果
2. **Service层**: 负责业务逻辑处理
3. **Mapper层**: 负责数据库操作
4. **Domain层**: 实体类，对应数据库表
5. **Aspect层**: 切面类，用于日志记录等横切关注点
6. **统一返回格式**: 使用`Result<T>`封装返回结果
7. **异常处理**: 统一异常处理机制
8. **权限控制**: 使用`@RequiresRole`注解进行权限控制

---

*文档更新时间: 2024年*

