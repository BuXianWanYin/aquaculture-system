# 水产养殖计划与产量统计系统 - 前端项目

## 项目简介

水产养殖计划与产量统计系统前端项目，基于 Vue 3 构建的现代化 Web 应用。本项目采用前后端分离架构，提供直观友好的用户界面，支持养殖计划管理、产量统计、数据分析等核心业务功能。

---

## 技术栈

### 核心框架

| 技术 | 版本 | 说明 |
|------|------|------|
| **Vue** | 3.5.13 | 渐进式 JavaScript 框架，采用 Composition API |
| **Vite** | 6.0.5 | 新一代前端构建工具，提供快速开发体验 |

### 路由管理

| 技术 | 版本 | 说明 |
|------|------|------|
| **Vue Router** | 4.4.5 | Vue.js 官方路由管理器，支持路由守卫和权限控制 |

### 状态管理

| 技术 | 版本 | 说明 |
|------|------|------|
| **Pinia** | 2.1.7 | Vue 3 官方推荐的状态管理库，用于管理用户信息和全局状态 |

### UI 组件库

| 技术 | 版本 | 说明 |
|------|------|------|
| **Element Plus** | 2.8.8 | 基于 Vue 3 的企业级 UI 组件库 |
| **@element-plus/icons-vue** | 2.3.1 | Element Plus 官方图标库 |

### HTTP 请求

| 技术 | 版本 | 说明 |
|------|------|------|
| **Axios** | 1.7.7 | 基于 Promise 的 HTTP 客户端，用于 API 请求 |

### 数据可视化

| 技术 | 版本 | 说明 |
|------|------|------|
| **ECharts** | 5.5.1 | 百度开源的数据可视化图表库，用于仪表盘和报表展示 |

### 开发依赖

| 技术 | 版本 | 说明 |
|------|------|------|
| **@vitejs/plugin-vue** | 5.2.1 | Vite 的 Vue 3 插件 |

---

## 项目结构

```
aquaculture-web/
├── public/                    # 静态资源目录
│   └── vite.svg
├── src/                       # 源代码目录
│   ├── api/                   # API 接口封装
│   │   ├── user.js           # 用户相关接口
│   │   ├── role.js           # 角色相关接口
│   │   ├── permission.js     # 权限相关接口
│   │   ├── plan.js           # 计划相关接口
│   │   ├── yield.js          # 产量相关接口
│   │   ├── dashboard.js      # 仪表盘接口
│   │   ├── statistic.js      # 统计接口
│   │   ├── area.js           # 区域接口
│   │   ├── breed.js          # 品种接口
│   │   ├── department.js     # 部门接口
│   │   ├── equipment.js      # 设备接口
│   │   ├── diseaseRecord.js  # 病害记录接口
│   │   ├── diseasePrevention.js  # 病害预防接口
│   │   ├── feedInventory.js  # 饲料库存接口
│   │   ├── feedPurchase.js   # 饲料采购接口
│   │   ├── feedUsage.js      # 饲料使用接口
│   │   ├── feedingRecord.js  # 投喂记录接口
│   │   ├── dailyInspection.js # 日常巡检接口
│   │   ├── medicinePurchase.js # 药品采购接口
│   │   ├── medicineInventory.js # 药品库存接口
│   │   ├── medicineUsage.js  # 用药记录接口
│   │   ├── customer.js       # 客户接口
│   │   ├── salesRecord.js    # 销售记录接口
│   │   ├── yieldEvidence.js  # 产量凭证接口
│   │   ├── planAdjust.js     # 计划调整接口
│   │   ├── message.js        # 消息接口
│   │   └── operLog.js        # 操作日志接口
│   ├── composables/          # 组合式函数
│   │   ├── usePermission.js  # 权限判断工具
│   │   └── useRole.js        # 角色判断工具
│   ├── constants/            # 常量定义
│   │   ├── permission.js     # 权限代码常量
│   │   └── role.js           # 角色常量
│   ├── layout/               # 布局组件
│   │   └── Index.vue         # 主布局组件
│   ├── router/               # 路由配置
│   │   └── index.js          # 路由定义和守卫
│   ├── stores/               # Pinia 状态管理
│   │   └── user.js           # 用户状态管理
│   ├── utils/                # 工具函数
│   │   ├── request.js        # Axios 请求封装
│   │   ├── permission.js     # 权限工具函数
│   │   └── date.js           # 日期工具函数
│   ├── views/                # 页面组件
│   │   ├── Login.vue         # 登录页面
│   │   ├── Register.vue      # 注册页面
│   │   ├── Dashboard.vue     # 仪表盘页面
│   │   ├── user/             # 用户管理
│   │   │   └── UserList.vue
│   │   ├── role/             # 角色管理
│   │   │   └── RoleList.vue
│   │   ├── permission/       # 权限管理
│   │   │   └── PermissionList.vue
│   │   ├── department/       # 部门管理
│   │   │   └── DepartmentList.vue
│   │   ├── area/             # 区域管理
│   │   │   └── AreaList.vue
│   │   ├── breed/            # 品种管理
│   │   │   └── BreedList.vue
│   │   ├── equipment/        # 设备管理
│   │   │   └── EquipmentList.vue
│   │   ├── plan/             # 计划管理
│   │   │   └── PlanList.vue
│   │   ├── yield/            # 产量管理
│   │   │   └── YieldList.vue
│   │   ├── production/       # 生产管理
│   │   │   ├── ProductionManagement.vue
│   │   │   ├── DailyInspection.vue
│   │   │   └── FeedingRecord.vue
│   │   ├── feed/             # 饲料管理
│   │   │   ├── FeedManagement.vue
│   │   │   ├── FeedInventory.vue
│   │   │   ├── FeedPurchase.vue
│   │   │   └── FeedUsage.vue
│   │   ├── disease/          # 病害管理
│   │   │   ├── DiseaseManagement.vue
│   │   │   ├── DiseaseRecord.vue
│   │   │   ├── DiseasePrevention.vue
│   │   │   └── MedicineUsage.vue
│   │   ├── sales/            # 销售管理
│   │   │   ├── SalesManagement.vue
│   │   │   ├── SalesRecord.vue
│   │   │   └── Customer.vue
│   │   ├── statistic/        # 统计分析
│   │   │   └── StatisticList.vue
│   │   ├── message/          # 消息通知
│   │   │   └── MessageList.vue
│   │   ├── operLog/          # 操作日志
│   │   │   └── OperLogList.vue
│   │   └── profile/          # 个人中心
│   │       └── Profile.vue
│   ├── App.vue               # 根组件
│   ├── main.js               # 入口文件
│   └── style.css             # 全局样式
├── index.html                # HTML 模板
├── vite.config.js            # Vite 配置文件
├── package.json              # 项目依赖配置
└── README.md                 # 项目说明文档
```

---

## 核心功能模块

### 1. 用户认证与权限管理
- 用户登录/注册
- JWT Token 管理
- 基于权限的页面和按钮控制
- 用户信息管理

### 2. 基础数据管理
- 养殖品种管理
- 养殖区域管理
- 设备信息管理
- 部门管理

### 3. 养殖计划管理
- 计划录入与编辑
- 计划审批流程
- 计划调整管理（支持延长周期、修改目标产量、修改投放量等调整类型，动态表单验证）
- 计划查询与筛选
- 计划状态管理（支持手动修改状态：已通过→执行中/已完成，执行中→已完成）
- 状态标签颜色：待审批（橙色）、已通过（浅绿色）、已驳回（红色）、执行中（蓝色）、已完成（深绿色）

### 4. 产量统计管理
- 产量录入（只能选择已审核通过的养殖计划）
- 产量审核
- 产量凭证上传
- 产量统计分析
- 支持按养殖计划查询已审核通过的产量统计（用于销售记录绑定）

### 5. 生产管理
- 日常巡检记录
- 投喂记录管理
- 饲料库存管理（支持详情查看采购记录）
- 饲料采购与使用（支持新采购和已有采购选择，自动更新库存）
- 饲料使用（支持批次号下拉选择，自动扣减库存）

### 6. 药品管理
- 药品采购管理（支持新采购和已有采购选择，自动更新库存）
- 药品库存管理（支持详情查看采购记录）
- 用药记录管理（与药品库存联动，自动扣减库存）

### 7. 病害管理
- 病害记录
- 病害预防
- 用药记录管理（选择养殖计划后自动绑定所属区域和病害记录，选择药品后自动填充类型、单价、单位，选择批次号后自动填充有效期）

### 8. 销售管理
- 客户信息管理
- 销售记录管理（选择养殖计划后自动绑定产量统计下拉选择）

### 9. 数据报表与分析
- 仪表盘数据展示
- 多维度统计分析
- 数据可视化图表

### 10. 系统管理
- 操作日志查询
- 消息通知管理
- 权限管理（分配权限时权限树默认折叠）

---

## 开发指南

### 环境要求

- **Node.js**: 16.0 或更高版本
- **npm**: 7.0 或更高版本（或使用 yarn/pnpm）

### 安装依赖

```bash
npm install
```
### 开发模式

```bash
npm run dev
```

启动后访问：http://localhost:3000（或环境变量 `VITE_PORT` 配置的端口）

### 构建项目

```bash
npm run build
```

构建产物将输出到 `dist` 目录。

### 预览构建结果

```bash
npm run preview
```

---

## 配置文件说明

### 环境变量配置

项目使用环境变量进行配置管理，支持不同环境使用不同配置。

#### 环境变量文件

项目已包含 `.env.development` 文件，包含以下配置：

```env
# 开发环境配置
VITE_PORT=3000
VITE_API_BASE_URL=http://localhost:8080
VITE_API_PREFIX=/api
VITE_UPLOAD_PREFIX=/uploads
VITE_REQUEST_TIMEOUT=10000
```

**说明：**
- 项目已自带 `.env.development` 文件，无需创建或复制
- 如需修改配置，直接编辑该文件即可
- 配置文件位于项目根目录：`aquaculture-web/.env.development`

#### 环境变量说明

| 变量名 | 说明 | 默认值 | 示例 |
|--------|------|--------|------|
| `VITE_PORT` | 开发服务器端口 | `3000` | `3000` |
| `VITE_API_BASE_URL` | 后端 API 基础地址 | `http://localhost:8080` | `http://localhost:8080` |
| `VITE_API_PREFIX` | API 请求前缀 | `/api` | `/api` |
| `VITE_UPLOAD_PREFIX` | 上传文件路径前缀 | `/uploads` | `/uploads` |
| `VITE_REQUEST_TIMEOUT` | 请求超时时间（毫秒） | `10000` | `10000` |

**注意：**
- 环境变量必须以 `VITE_` 开头才能在客户端代码中访问
- 项目已包含 `.env.development` 文件，可直接使用
- 如需修改配置，直接编辑 `.env.development` 文件即可
- `.env.local` 和 `.env.*.local` 文件不会被提交（用于本地覆盖配置）
- 环境变量修改后需要重启开发服务器才能生效

### vite.config.js

```javascript
import { defineConfig, loadEnv } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'

export default defineConfig(({ command, mode }) => {
  // 加载环境变量
  const env = loadEnv(mode, process.cwd(), '')

  // 从环境变量获取配置，如果没有则使用默认值
  const port = parseInt(env.VITE_PORT || '3000', 10)
  const apiBaseUrl = env.VITE_API_BASE_URL || 'http://localhost:8080'
  const apiPrefix = env.VITE_API_PREFIX || '/api'
  const uploadPrefix = env.VITE_UPLOAD_PREFIX || '/uploads'

  return {
    plugins: [vue()],
    resolve: {
      alias: {
        '@': path.resolve(__dirname, 'src')
      }
    },
    server: {
      port: port,
      proxy: {
        [apiPrefix]: {
          target: apiBaseUrl,
          changeOrigin: true
        },
        [uploadPrefix]: {
          target: apiBaseUrl,
          changeOrigin: true
        }
      }
    }
  }
})
```

**关键配置：**
- 开发服务器端口：从 `VITE_PORT` 环境变量读取（默认 3000）
- API 代理：从环境变量动态配置
- 文件上传代理：从环境变量动态配置
- 路径别名：`@` 指向 `src` 目录
- 支持不同环境使用不同配置

---

## 核心代码说明

### 请求封装 (utils/request.js)

```javascript
import axios from 'axios'
import { ElMessage } from 'element-plus'
import router from '@/router'

// 从环境变量获取配置，如果没有则使用默认值
const apiPrefix = import.meta.env.VITE_API_PREFIX || '/api'
const requestTimeout = parseInt(import.meta.env.VITE_REQUEST_TIMEOUT || '10000', 10)

// 创建 Axios 实例
const request = axios.create({
  baseURL: apiPrefix,
  timeout: requestTimeout
})

// 请求拦截器：自动添加 Token
request.interceptors.request.use(config => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// 响应拦截器：统一处理错误
request.interceptors.response.use(
  response => {
    const res = response.data
    if (res.code === 200) {
      return res
    } else {
      ElMessage.error(res.message || '请求失败')
      return Promise.reject(new Error(res.message || '请求失败'))
    }
  },
  error => {
    // 处理 HTTP 错误状态码
    if (error.response) {
      switch (error.response.status) {
        case 401:
          ElMessage.error('未授权，请重新登录')
          localStorage.removeItem('token')
          router.push('/login')
          break
        case 403:
          ElMessage.error('拒绝访问')
          break
        case 404:
          ElMessage.error('请求错误，未找到该资源')
          break
        case 500:
          ElMessage.error('服务器错误')
          break
        default:
          ElMessage.error(error.response.data?.message || '网络错误')
      }
    } else {
      ElMessage.error('网络连接失败')
    }
    return Promise.reject(error)
  }
)

export default request
```

**关键特性：**
- 使用环境变量配置 API 前缀和超时时间
- 自动添加 JWT Token 到请求头
- 统一处理响应和错误
- 401 错误自动跳转登录页

### 状态管理 (stores/user.js)

使用 Pinia 管理用户状态：

```javascript
export const useUserStore = defineStore('user', () => {
  const token = ref(localStorage.getItem('token') || '')
  const userInfo = ref(JSON.parse(localStorage.getItem('userInfo') || 'null'))

  const loginAction = async (loginData) => {
    const res = await login(loginData)
    if (res.code === 200 && res.data?.token) {
      setToken(res.data.token)
      setUserInfo(res.data)
      return true
    }
    throw new Error(res.message || '登录失败')
  }

  return { token, userInfo, loginAction, logout }
})
```

### 权限控制 (composables/usePermission.js)

```javascript
export const usePermission = () => {
  const userStore = useUserStore()
  
  const hasPermission = (permissionCode) => {
    const permissions = userStore.userInfo?.permissions || []
    return permissions.includes(permissionCode)
  }
  
  return { hasPermission }
}
```

在组件中使用：

```vue
<script setup>
import { usePermission } from '@/composables/usePermission'

const { hasPermission } = usePermission()
</script>

<template>
  <el-button v-if="hasPermission('plan:add')" @click="handleAdd">
    新增计划
  </el-button>
</template>
```

---

## API 接口说明

所有 API 接口都封装在 `src/api/` 目录下，统一使用 `request` 工具发送请求。

### 接口响应格式

```typescript
interface Result<T> {
  code: number      // 200 表示成功，其他表示失败
  message: string   // 响应消息
  data: T          // 响应数据
}
```

### 接口示例

```javascript
// 用户登录
export const login = (data) => {
  return request({
    url: '/user/login',
    method: 'post',
    data
  })
}

// 分页查询用户列表
export const getUserList = (params) => {
  return request({
    url: '/user/page',
    method: 'get',
    params
  })
}
```

---

## 路由配置

路由配置在 `src/router/index.js`，支持：
- 路由守卫（登录验证、权限验证）
- 动态路由加载
- 路由元信息（meta）配置

### 路由守卫示例

```javascript
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token')
  
  if (to.path === '/login') {
    if (token) {
      next('/dashboard')
    } else {
      next()
    }
  } else {
    if (!token) {
      next('/login')
    } else {
      // 权限验证
      if (to.meta.permissions) {
        const hasPermission = checkPermission(to.meta.permissions)
        if (!hasPermission) {
          ElMessage.warning('您没有权限访问该页面')
          next('/dashboard')
          return
        }
      }
      next()
    }
  }
})
```

---

## 权限控制

### 权限代码格式

- 格式：`模块:操作` 或 `模块:子模块:操作`
- 示例：
  - `system:user:view` - 系统管理-用户-查看
  - `plan:add` - 计划-新增
  - `yield:evidence:delete` - 产量-凭证-删除

### 权限使用方式

1. **页面级权限**：在路由配置中设置 `meta.permissions`
2. **按钮级权限**：使用 `v-if="hasPermission('xxx')"` 控制显示
3. **菜单级权限**：根据用户权限动态生成菜单

---

## 开发规范

### 文件命名规范

- 组件文件：PascalCase（如 `UserList.vue`）
- 工具文件：camelCase（如 `request.js`）
- API 文件：camelCase（如 `user.js`）

### 代码规范

- 使用 Vue 3 Composition API
- 组件单一职责原则
- Props 和 Emits 明确类型
- 统一使用 ESLint 进行代码检查

### 组件开发规范

```vue
<script setup>
import { ref, computed, onMounted } from 'vue'
import { usePermission } from '@/composables/usePermission'
import { getUserList } from '@/api/user'

const { hasPermission } = usePermission()

const userList = ref([])
const loading = ref(false)

const fetchData = async () => {
  loading.value = true
  try {
    const res = await getUserList({ current: 1, size: 10 })
    userList.value = res.data.records
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  fetchData()
})
</script>

<template>
  <div>
    <el-button 
      v-if="hasPermission('user:add')" 
      @click="handleAdd"
    >
      新增用户
    </el-button>
  </div>
</template>
```

---

## 开发说明

### 环境变量加载

- **开发模式（`npm run dev`）**：自动加载 `.env.development` 文件
- **预览模式（`npm run preview`）**：使用构建后的静态文件预览

---

## 依赖清单

### 生产依赖

```json
{
  "vue": "^3.5.13",
  "vue-router": "^4.4.5",
  "pinia": "^2.1.7",
  "axios": "^1.7.7",
  "element-plus": "^2.8.8",
  "@element-plus/icons-vue": "^2.3.1",
  "echarts": "^5.5.1"
}
```

### 开发依赖

```json
{
  "@vitejs/plugin-vue": "^5.2.1",
  "vite": "^6.0.5"
}
```

---

## 常见问题

### 1. 环境变量配置

**问题：** 如何配置 API 地址？

**解决方案：**
- 项目已包含 `.env.development` 文件，直接编辑该文件
- 修改 `VITE_API_BASE_URL` 为实际的后端服务地址
- 环境变量修改后需要重启开发服务器（`npm run dev`）才能生效

### 2. 跨域问题

开发环境已配置代理，通过 `.env.development` 文件中的 `VITE_API_BASE_URL` 配置后端地址。如果遇到跨域问题，请检查：
- `.env.development` 文件中的 `VITE_API_BASE_URL` 是否正确
- 后端服务是否已启动
- 代理配置是否正确

### 3. Token 过期

Token 过期后会自动跳转到登录页面，用户需要重新登录。可以在 `.env.development` 文件中通过 `VITE_REQUEST_TIMEOUT` 配置请求超时时间。

### 4. 权限控制

前端权限控制主要用于 UI 展示，真正的权限验证在后端进行。

### 5. 环境变量不生效

**问题：** 修改环境变量后配置没有生效？

**解决方案：**
- 确保环境变量以 `VITE_` 开头
- 修改环境变量后需要重启开发服务器（停止 `npm run dev` 后重新启动）
- 检查是否编辑的是 `.env.development` 文件（位于 `aquaculture-web/` 目录下）
- 在代码中使用 `import.meta.env.VITE_变量名` 访问环境变量
- 确保文件格式正确，使用 `KEY=value` 格式，不要有多余的空格

---

## 参考资料

- [Vue 3 官方文档](https://cn.vuejs.org/)
- [Vite 官方文档](https://cn.vitejs.dev/)
- [Element Plus 官方文档](https://element-plus.org/zh-CN/)
- [Vue Router 官方文档](https://router.vuejs.org/zh/)
- [Pinia 官方文档](https://pinia.vuejs.org/zh/)
- [ECharts 官方文档](https://echarts.apache.org/zh/index.html)

---

---

## 核心功能特性说明

### 表单验证优化

- **延迟验证**：表单打开时不立即显示验证错误，只有在内容变化时才触发验证
- **动态验证规则**：根据选择的不同调整类型（延长周期、修改目标产量、修改投放量）动态显示对应的输入字段和验证规则

### 饲料管理功能

1. **饲料使用**
   - 饲料名称下拉选择，自动绑定单价、饲料类型
   - 批次号动态下拉：如果只有一条采购记录，自动绑定；如果有多条，显示下拉选择
   - 批次号后显示对应过期日期
   - 使用后自动扣减库存，并刷新库存页面

2. **饲料库存**
   - 主列表不显示批次号和保质期（因为同一饲料可能有多个批次）
   - 详情页显示该饲料的所有采购记录（包括批次号、保质期等）
   - 库存只能通过采购增加，不能直接新增或编辑
   - 已移除"仓储位置"字段

3. **饲料采购**
   - 支持选择"新采购"或"已有采购"
   - 选择已有采购时，自动绑定饲料类型和供应商
   - 采购成功后自动更新库存，并刷新库存页面

### 药品管理功能

1. **药品采购**
   - 支持选择"新采购"或"已有采购"
   - 选择已有采购时，自动绑定药品类型和供应商
   - 采购成功后自动更新库存，并刷新库存页面

2. **药品库存**
   - 主列表不显示批次号和有效期（因为同一药品可能有多个批次）
   - 详情页显示该药品的所有采购记录（包括批次号、有效期等）
   - 库存只能通过采购增加，不能直接新增或编辑

3. **用药记录**
   - 选择养殖计划后，自动绑定所属区域
   - 动态加载该计划的病害记录下拉选择
   - 药品名称下拉选择，自动填充药品类型、单价、单位
   - 批次号下拉选择，自动填充有效期
   - 用量和单价输入框宽度加大
   - 使用后自动扣减库存，并刷新库存页面

### 养殖计划管理

1. **计划调整**
   - 支持三种调整类型：延长周期、修改目标产量、修改投放量
   - 根据调整类型动态显示对应的输入字段
   - 已移除"其他"选项

2. **计划状态管理**
   - 状态标签颜色：
     - 待审批：橙色（warning）
     - 已通过：浅绿色（success）
     - 已驳回：红色（danger）
     - 执行中：蓝色（primary）
     - 已完成：深绿色（success + dark effect）
   - 编辑页面支持手动修改状态：
     - 已通过（状态1）→ 执行中（状态3）或已完成（状态4）
     - 执行中（状态3）→ 已完成（状态4）
   - 状态下拉框不会消失，保持可见

3. **计划筛选**
   - 产量统计、饲料管理、病害防控、日常生产记录、销售记录等页面只能选择"已通过"（状态1）的计划

### 销售记录管理

- 选择养殖计划后，自动加载该计划的已审核通过的产量统计
- 产量统计为必选下拉框（因为一个计划可能有多个产量统计）

### 权限管理

- 分配权限时，权限树节点默认折叠，而不是全部展开
- 支持按钮级权限控制

### 跨组件通信

- 使用自定义事件实现跨组件刷新：
  - `refresh-inventory`：刷新饲料库存页面
  - `refresh-medicine-inventory`：刷新药品库存页面
- 在饲料采购、饲料使用、药品采购、用药记录等操作后自动触发刷新事件

---

*文档更新时间: 2025年11月17日*
